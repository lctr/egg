<!DOCTYPE html>
<html>

<head>
  <base href="./">
  <meta charset="UTF-8">
  <title>Hello World!</title>
  <link rel="stylesheet" href="./style.css">
  <script src="./egg.js" charset="utf-8"></script>
</head>

<body>

  <div>
    <div class="container">
      <textarea id="code-editor"></textarea>
      <div class="controls">
        <button id="run">Run</button>
        <button id="clear">Clear</button>
      </div>

      <div id="code-output">
        <div id="tree">
          <pre id="json"></pre>
        </div>
        <div id="results"></div>
      </div>
    </div>
  </div>

  <script>
    let ready = false;
    const button = document.getElementById("run");
    const textarea = document.getElementById("code-editor");
    const json = document.getElementById("json");
    const results = document.getElementById("results");

    const ast = (input) => JSON.stringify(parse(input), null, 2);

    textarea.oninput = () => {
      if (textarea.value.trim().length === 0) {
        ready = false;
        return;
      }
      let tree = '';
      try {
        tree = ast(textarea.value);
        ready = true;
      } catch (e) {
        tree = '· · ·';
      }
      json.textContent = tree;
    }

    button.onclick = () => {
      if (!ready) return;
      let eggTree = '', eggResults = '';
      try {
        eggTree = ast(textarea.value);
        eggResults = run(textarea.value);
      } catch (e) {
        eggTree = 'Error!';
        eggResults = e;
        alert(e);
      }
      tree.textContent = eggTree;
      results.innerHTML = eggResults;
    };
  </script>
</body>

</html>